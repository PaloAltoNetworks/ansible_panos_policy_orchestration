---
- name: Tests the panos_op_routing_result_to_interfaces filter is working properly
  hosts: lab # <---- Replace this with your group
  connection: local
  gather_facts: true # <--- Requied for getting the current time

  vars:
    provider:
      ip_address: "{{ ansible_host }}"
      username: "{{ lookup('env', 'ANSIBLE_NET_USERNAME') }}"
      password: "{{ lookup('env', 'ANSIBLE_NET_PASSWORD') }}"
    serialno: "{{ lookup('env', 'PAN_TEST_SERIAL') }}"

  tasks:
    # Check if security policy match found a result
    - name: Run a Fib lookup
      paloaltonetworks.panos.panos_op:
        provider:
          ip_address: "{{ provider.ip_address }}"
          username: "{{ provider.username }}"
          password: "{{ provider.password }}"
          serial_number: "{{ serialno }}"
        cmd: "<test><routing><fib-lookup><virtual-router>default</virtual-router><ip>8.8.8.8</ip></fib-lookup></routing></test>"
        cmd_is_xml: true
      register: lookup_policy__test_routing_result

    - name: Get interfaces from results
      ansible.builtin.set_fact:
        lookup_policy_interface_list: >
          {{ lookup_policy__test_routing_result |
             paloaltonetworks.panos_policy_automation.panos_op_routing_result_to_interfaces }}

    - name: Print results
      ansible.builtin.debug:
        msg: "{{ lookup_policy_interface_list }}"
